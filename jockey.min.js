!function(i){"use strict";var t=-1,s=!1,h=function(){},e=function(i,t,s){var h=i[t];return i[t]=i[s],i[s]=h,i},n=function(i,t){return Math.floor(Math.random()*(t-i+1))+i},f=function(i,e){return this instanceof f?(this.items=i||[],e=e||{},this.mc=e.modelChange||h,this.sc=e.stateChange||h,this.shuffled=s,this.i=t,this.repeatFlag=!1,void(this.pauseFlag=!1)):new f(i,e)},u=f.prototype;u.add=function(i){if(null==i)throw new Error("need an item");this.items.push(i),this.isShuffling()&&(this.shuffled.push(i),this._s(this.shuffled,this.isMounted()?this.i+1:0)),this.mc("add",this.items)},u.remove=function(i){this._c(i);var t=this.getCurrent(),s=this.items[i];this.items.splice(i,1),this.isShuffling()&&(i=this.shuffled.indexOf(s),this.shuffled.splice(i,1)),i<this.i?this.i--:s==t&&this.stop(),this.mc("remove",this.items)},u.set=function(i,t){if(this._c(i),null==t)throw new Error("need an item");var s=this.items[i];this.items[i]=t,this.isShuffling()&&(i=this.shuffled.indexOf(s),this.shuffled[i]=t),this.mc("set",this.items)},u.size=function(){return this.items.length},u.get=function(i){return null==i?this.items:(this._c(i),this.items[i])},u.getCurrentIndex=function(){return this.isMounted()?this.isShuffling()?this.items.indexOf(this.getCurrent()):this.i:t},u.getCurrent=function(){return this.isMounted()?this.isShuffling()?this.shuffled[this.i]:this.items[this.i]:null},u.isMounted=function(){return this.i!==t},u.isPlaying=function(){return this.isMounted()&&!this.pauseFlag},u.isPaused=function(){return this.isMounted()&&this.pauseFlag},u.play=function(i){if(this._c(i||0),null==i){if(this.isPaused())return this.pauseFlag=!1,void this.sc("resume",this.getCurrent());if(this.isPlaying())return this.pauseFlag=!0,void this.sc("pause",this.getCurrent());this.i=0}else this.isShuffling()?(this.shuffled=this.items.slice(),e(this.shuffled,0,i),this._s(this.shuffled,1),this.i=0):this.i=i;this.sc("play",this.getCurrent())},u.stop=function(){this.isShuffling()&&this._r(),this.i=t,this.sc("stop")},u.isRepeating=function(){return this.repeatFlag},u.repeat=function(){this.repeatFlag=!this.repeatFlag,this.sc("repeat")},u.isShuffling=function(){return this.shuffled!==s},u.shuffle=function(){if(this.isShuffling())this.isMounted()&&(this.i=this.getCurrentIndex()),this.shuffled=s;else if(this.isMounted()){this.shuffled=this.items.slice();var i=this.shuffled[this.i];this.shuffled[this.i]=this.shuffled[0],this.shuffled[0]=i,this._s(this.shuffled,1),this.i=0}else this._r();this.sc("shuffle")},u.previous=function(){var i=this.items.length;if(this.isMounted()&&i)if(this.i>0)this.i--,this._p();else if(this.isRepeating()){if(this.isShuffling()){var t=this.getCurrent();if(this._r(),i>1&&this.shuffled[i-1]===t){var s=n(0,this.items.length-2);e(this.shuffled,i-1,s)}}this.i=i-1,this._p()}else this.stop()},u.next=function(){var i=this.items.length;if(this.isMounted()&&i)if(this.i<i-1)this.i++,this._p();else if(this.isRepeating()){if(this.isShuffling()){var t=this.getCurrent();if(this._r(),i>1&&this.shuffled[0]===t){var s=n(1,this.items.length-1);e(this.shuffled,0,s)}}this.i=0,this._p()}else this.stop()},u.reorder=function(i,t){this._c(i),this._c(t);var s=this.items.splice(i,1)[0];this.items.splice(t,0,s),this.isMounted()&&!this.isShuffling()&&(this.i===i?this.i=t:i<=this.i&&t>=this.i?this.i--:i>=this.i&&t<=this.i&&this.i++),this.mc("reorder",this.items)},u._c=function(i,t){if(0>i||i>=(t||this.items.length))throw new Error("invalid index: "+i)},u._r=function(){this.shuffled=this.items.slice(),this._s(this.shuffled,0)},u._s=function(i,t){t=t||0;for(var s=i.length-1;s>t;){var h=Math.max(t,Math.floor(Math.random()*(s+1)));e(i,s,h),s--}return i},u._p=function(){this.pauseFlag=!1,this.sc("play",this.getCurrent())},"object"==typeof module?module.exports=f:i.jockey=f}(this);